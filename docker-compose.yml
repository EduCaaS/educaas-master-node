version: '2'
services:
  mysql:
    restart: unless-stopped
    image: mariadb
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
      MYSQL_USER: ${DB_USER}
      MYSQL_PASS: ${DB_PASSWORD}
      MYSQL_DATABASE: ${DB_NAME}
    ports:
      - "3306:3306"
    volumes:
      - educaas_db:/var/lib/mysql

  rancher:
    restart: unless-stopped
    ports:
      - "8080:8080"
      - "9345:9345" 
    image: rancher/server:stable
    command: --advertise-address ${MACHINE_IP} --db-host: mysql --db-port: 3306 --db-name: ${DB_NAME} --db-pass: ${DB_PASSWORD} --db-user: ${DB_USER}
    env_file: .env

  lets-nginx:
    links:
      - rancher:backend
    environment:
      - EMAIL=${EMAIL}
      - DOMAIN=${DOMAIN}
      - UPSTREAM=rancher:8080
    ports:
      - 80:80
      - 443:443
    image: smashwilson/lets-nginx
    env_file: .env

volumes:
  educaas_db:
